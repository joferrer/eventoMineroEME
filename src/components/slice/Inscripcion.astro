---
import SliceTitulo from "../SliceTitulo.astro";
import sound from "../../assets/sound/Sound.mp3";
---

<div
  class="min-h-screen relative overflow-hidden bg-white dark:bg-[#0f0f1a] transition-colors duration-300"
  id="inscripcion"
>
  <!-- Toast container -->
  <div
    id="toast"
    class="fixed top-5 right-5 px-6 py-3 shadow-lg text-white font-semibold rounded-xl transform translate-x-full opacity-0 transition-all duration-500 ease-in-out z-50"
  >
  </div>

  <!-- Sonidos -->
  <audio id="toastSuccessSound" src={sound} preload="auto"></audio>
  <div class="relative z-10 container mx-auto px-4 py-12">
    <!-- Formulario -->
    <div class="max-w-4xl mx-auto">
      <form
        class="backdrop-blur-xl bg-black/5 dark:bg-white/10 border border-black/10 dark:border-white/20 rounded-3xl p-6 md:p-12 shadow-xl hover:shadow-blue-500/20transition-all duration-500"
        id="registroForm"
      >
        <SliceTitulo title="Registro de Asistentes" />

        <div class="grid md:grid-cols-2 gap-8">
          <!-- Nombre completo -->
          <div class="md:col-span-2 group">
            <div class="relative">
              <input
                type="text"
                id="nombre"
                name="nombre_coompleto"
                required
                class="peer w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white placeholder-transparent focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
                placeholder="Nombre completo"
                minlength="3"
                maxlength="100"
              />
              <label
                for="nombre"
                class="absolute left-0 -top-3 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2 peer-placeholder-shown:text-black/50 dark:peer-placeholder-shown:text-white/60 peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-placeholder-shown:font-normal peer-focus:-top-5 peer-focus:text-sm peer-focus:font-semibold transition-all duration-300"
              >
                Nombre completo *
              </label>
            </div>
            <p class="text-black/70 dark:text-white/70 text-sm mt-2 ml-2">
              Para acreditación y certificados de asistencia
            </p>
          </div>

          <!-- Tipo de identidad -->
          <div class="group">
            <div class="relative">
              <select
                id="tipoIdentidad"
                name="tipo_doc"
                required
                class="w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
              >
                <option value="" class="text-gray-800 bg-gray-100"
                  >Seleccionar tipo</option
                >
                <option value="cedula" class="text-gray-800 bg-gray-100"
                  >Cédula de Ciudadanía</option
                >
                <option value="pasaporte" class="text-gray-800 bg-gray-100"
                  >Pasaporte</option
                >
                <option value="pasaporte" class="text-gray-800 bg-gray-100"
                  >otro</option
                >
              </select>
              <label
                class="absolute left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2"
              >
                Tipo de identidad *
              </label>
            </div>
            <p class="text-black/70 dark:text-white/70 text-sm mt-2 ml-2">
              Para control de ingreso y certificación
            </p>
          </div>

          <!-- Documento de identidad -->
          <div class="group">
            <div class="relative">
              <input
                type="text"
                id="documento"
                name="documento"
                required
                class="peer w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white placeholder-transparent focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
                placeholder="Documento de identidad"
                minlength="6"
                maxlength="20"
              />
              <label
                for="documento"
                class="absolute left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2 peer-placeholder-shown:text-black/50 dark:peer-placeholder-shown:text-white/60 peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-placeholder-shown:font-normal peer-focus:-top-5 peer-focus:text-sm peer-focus:font-semibold transition-all duration-300"
              >
                Documento de identidad *
              </label>
            </div>
            <p class="text-black/70 dark:text-white/70 text-sm mt-2 ml-2">
              Número del documento seleccionado
            </p>
          </div>

          <!-- Correo electrónico -->
          <div class="group">
            <div class="relative">
              <input
                type="email"
                id="correo"
                name="correo"
                required
                class="peer w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white placeholder-transparent focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
                placeholder="Correo electrónico"
                minlength="5"
                maxlength="60"
              />
              <label
                for="correo"
                class="absolute left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2 peer-placeholder-shown:text-black/50 dark:peer-placeholder-shown:text-white/60 peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-placeholder-shown:font-normal peer-focus:-top-5 peer-focus:text-sm peer-focus:font-semibold transition-all duration-300"
              >
                Correo electrónico *
              </label>
            </div>
            <p class="text-black/70 dark:text-white/70 text-sm mt-2 ml-2">
              Donde desea recibir memorias y presentaciones del evento
            </p>
          </div>

          <!-- Número de celular -->
          <div class="group">
            <div class="relative">
              <input
                type="tel"
                id="celular"
                name="celular"
                required
                class="peer w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white placeholder-transparent focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
                placeholder="Número de celular"
                minlength="7"
                maxlength="13"
              />
              <label
                for="celular"
                class="absolute left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2 peer-placeholder-shown:text-black/50 dark:peer-placeholder-shown:text-white/60 peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-placeholder-shown:font-normal peer-focus:-top-5 peer-focus:text-sm peer-focus:font-semibold transition-all duration-300"
              >
                Número de celular *
              </label>
            </div>
            <p class="text-black/70 dark:text-white/70 text-sm mt-2 ml-2">
              Para contacto antes o durante el evento si es necesario
            </p>
          </div>

          <!-- Empresa o entidad -->
          <div class="group">
            <div class="relative">
              <input
                type="text"
                id="empresa"
                name="empresa_representa"
                required
                class="peer w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white placeholder-transparent focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
                placeholder="Empresa o entidad"
                minlength="3"
                maxlength="40"
              />
              <label
                for="empresa"
                class="absolute w-[340px] left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2 peer-placeholder-shown:text-black/50 dark:peer-placeholder-shown:text-white/60 peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-placeholder-shown:font-normal peer-focus:-top-5 peer-focus:text-sm peer-focus:font-semibold transition-all duration-300"
              >
                Empresa o entidad que representa *
              </label>
            </div>
            <p class="text-black/70 dark:text-white/70 text-sm mt-2 ml-2">
              Nombre completo de la organización
            </p>
          </div>

          <!-- Cargo o rol -->
          <div class="group">
            <div class="relative">
              <input
                type="text"
                id="cargo"
                name="cargo"
                required
                class="peer w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white placeholder-transparent focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
                placeholder="Cargo o rol"
                minlength="3"
                maxlength="40"
              />
              <label
                for="cargo"
                class="absolute w-[340px] left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2 peer-placeholder-shown:text-black/50 dark:peer-placeholder-shown:text-white/60 peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-placeholder-shown:font-normal peer-focus:-top-5 peer-focus:text-sm peer-focus:font-semibold transition-all duration-300"
              >
                Cargo o rol dentro de la organización *
              </label>
            </div>
            <p class="text-black/70 dark:text-white/70 text-sm mt-2 ml-2">
              Su posición o función actual
            </p>
          </div>

          <!-- Tipo de entidad -->
          <div class="group">
            <div class="relative">
              <select
                id="tipoEntidad"
                name="tipo_entidad"
                required
                class="w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
              >
                <option value="" class="text-gray-800 bg-gray-100"
                  >Seleccionar tipo de entidad</option
                >
                <option
                  value="empresa_privada"
                  class="text-gray-800 bg-gray-100">Empresa privada</option
                >
                <option
                  value="entidad_publica"
                  class="text-gray-800 bg-gray-100">Entidad pública</option
                >
                <option
                  value="academia_universidad"
                  class="text-gray-800 bg-gray-100"
                  >Academia / Universidad</option
                >
                <option
                  value="medio_comunicacion"
                  class="text-gray-800 bg-gray-100"
                  >Medio de comunicación</option
                >
                <option value="estudiante" class="text-gray-800 bg-gray-100"
                  >Estudiante</option
                >
                <option
                  value="independiente_consultor"
                  class="text-gray-800 bg-gray-100"
                  >Independiente / Consultor</option
                >
                <option value="otro" class="text-gray-800 bg-gray-100"
                  >Otro</option
                >
              </select>
              <label
                class="absolute left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2"
              >
                Tipo de entidad *
              </label>
            </div>
            <p class="text-black/70 dark:text-white/70 text-sm mt-2 ml-2">
              Categoría que mejor describe su organización
            </p>
          </div>

          <!-- Campo "Otro" (se muestra solo si selecciona "Otro") -->
          <div class="group" id="otroTipoEntidad" style="display: none;">
            <div class="relative">
              <input
                type="text"
                id="otroTipo"
                name="otro_tipo_entidad"
                class="peer w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white placeholder-transparent focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
                placeholder="Especifique otro tipo"
              />
              <label
                for="otroTipo"
                class="absolute left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2 peer-placeholder-shown:text-black/50 dark:peer-placeholder-shown:text-white/60 peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-placeholder-shown:font-normal peer-focus:-top-5 peer-focus:text-sm peer-focus:font-semibold transition-all duration-300"
              >
                Especifique el tipo de entidad
              </label>
            </div>
          </div>

          <div class="group">
            <div class="relative content">
              <select
                id="asociada"
                name="asociada_asocarbonor"
                required
                class="w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
              >
                <option value="" class="text-gray-800 bg-gray-100"
                  >Seleccionar tipo de entidad</option
                >
                <option value="si" class="text-gray-800 bg-gray-100">Si</option>
                <option value="no" class="text-gray-800 bg-gray-100">No</option>
                <option
                  value="no_aplica_No_se"
                  class="text-gray-800 bg-gray-100">No aplica / No sé</option
                >
              </select>
              <label
                class="absolute etiqueta left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2"
              >
                ¿Su organización está asociada a ASOCARBONOR? *
              </label>
            </div>
          </div>

          <!-- Pregunta 2: Días de asistencia -->

          <div class="group">
            <div class="relative">
              <select
                id="asistira"
                name="asistira_todo"
                required
                class="w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
              >
                <option value="" class="text-gray-800 bg-gray-100"
                  >Seleccionar tipo de entidad</option
                >
                <option value="si" class="text-gray-800 bg-gray-100">Si</option>
                <option
                  value="solo_el_19_de_noviembre"
                  class="text-gray-800 bg-gray-100"
                  >Solo el 19 de noviembre</option
                >
                <option
                  value="solo_el_20_de_noviembre"
                  class="text-gray-800 bg-gray-100"
                >
                  Solo el 20 de noviembre</option
                >
              </select>
              <label
                class="absolute left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2"
              >
                ¿Asistirá los dos días del evento? *
              </label>
            </div>
          </div>

          <!-- Pregunta 3: Boletín electrónico -->
          <div class="group">
            <div class="relative content">
              <select
                id="boletin"
                name="enviar_info"
                required
                class="w-full bg-black/5 dark:bg-white/10 border-2 border-black/20 dark:border-white/30 rounded-xl px-6 py-4 text-black dark:text-white focus:border-blue-500 focus:bg-black/10 dark:focus:bg-white/20 focus:outline-none transition-all duration-300 focus:scale-105 focus:shadow-lg focus:shadow-blue-500/30"
              >
                <option value="" class="text-gray-800 bg-gray-100"
                  >Seleccionar tipo de entidad</option
                >
                <option
                  value="si_quiero_mantenerme_informado"
                  class="text-gray-800 bg-gray-100"
                  >Sí, quiero mantenerme informado(a)</option
                >
                <option value="no_gracias" class="text-gray-800 bg-gray-100"
                  >No, gracias</option
                >
              </select>
              <label
                class="etiqueta absolute left-0 -top-5 bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent text-sm font-semibold px-2"
              >
                ¿Desea recibir el boletín electrónico de Asocarbonor? *
              </label>
            </div>
          </div>
        </div>

        <!-- Botón -->
        <div class="mt-16 text-center">
          <button
            type="submit"
            class="relative overflow-hidden bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-800 text-white font-bold py-6 px-16 rounded-full text-lg shadow-2xl hover:shadow-blue-600/30 transform hover:scale-105 hover:-translate-y-1 transition-all duration-300 group cursor-pointer"
          >
            <span class="relative z-10 flex items-center justify-center">
              <svg
                class="w-6 h-6 mr-3 group-hover:animate-spin"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4v1m0 14v1m8-8h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"
                ></path>
              </svg>
              Registrar Asistencia
            </span>
            <div
              class="absolute inset-0 bg-gradient-to-r from-blue-700 to-blue-900 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
            >
            </div>
          </button>
          <p
            class="text-black/60 dark:text-white/60 text-sm mt-6 max-w-md mx-auto leading-relaxed"
          >
            Todos los campos marcados con <span
              class="text-blue-500 font-semibold">*</span
            > son obligatorios.
          </p>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Mostrar/ocultar campo "Otro" según la selección
    document.addEventListener("DOMContentLoaded", function () {
      const tipoEntidadSelect = document.getElementById(
        "tipoEntidad"
      ) as HTMLSelectElement;
      const otroDiv = document.getElementById(
        "otroTipoEntidad"
      ) as HTMLDivElement;
      const otroInput = document.getElementById("otroTipo") as HTMLInputElement;

      if (tipoEntidadSelect && otroDiv && otroInput) {
        tipoEntidadSelect.addEventListener("change", function () {
          if (tipoEntidadSelect.value === "otro") {
            otroDiv.style.display = "block";
            otroInput.required = true;
          } else {
            otroDiv.style.display = "none";
            otroInput.required = false;
            otroInput.value = "";
          }
        });
      }
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Selección de elementos con tipos específicos
      const tipoEntidadSelect = document.getElementById(
        "tipoEntidad"
      ) as HTMLSelectElement | null;
      const otroDiv = document.getElementById(
        "otroDiv"
      ) as HTMLDivElement | null;
      const otroInput = document.getElementById(
        "otroInput"
      ) as HTMLInputElement | null;
      const form = document.getElementById(
        "registroForm"
      ) as HTMLFormElement | null;
      const toast = document.getElementById("toast") as HTMLDivElement | null;
      const successSound = document.getElementById(
        "toastSuccessSound"
      ) as HTMLAudioElement | null;
      const errorSound = document.getElementById(
        "toastErrorSound"
      ) as HTMLAudioElement | null;

      // Mostrar/ocultar campo "Otro"
      if (tipoEntidadSelect && otroDiv && otroInput) {
        tipoEntidadSelect.addEventListener("change", () => {
          if (tipoEntidadSelect.value === "otro") {
            otroDiv.style.display = "block";
            otroInput.required = true;
          } else {
            otroDiv.style.display = "none";
            otroInput.required = false;
            otroInput.value = "";
          }
        });
      }

      // Función para mostrar toasts con animación y sonido
      function showToast(
        message: string,
        type: "success" | "error" = "success"
      ) {
        if (!toast) return;

        toast.textContent = message;

        if (successSound) successSound.volume = 0.3;
        if (errorSound) errorSound.volume = 0.3;

        if (type === "success") {
          toast.className =
            "fixed top-5 right-5 px-6 py-3 rounded-xl shadow-lg text-white font-semibold bg-green-600 z-50 transform translate-x-0 opacity-100 scale-105 transition-all duration-500 ease-out";
          if (successSound) {
            successSound.currentTime = 0;
            successSound.play();
          }
        } else {
          toast.className =
            "fixed top-5 right-5 px-6 py-3 rounded-xl shadow-lg text-white font-semibold bg-red-600 z-50 transform translate-x-0 opacity-100 scale-105 transition-all duration-500 ease-out";
          if (errorSound) {
            errorSound.currentTime = 0;
            errorSound.play();
          }
        }

        toast.style.display = "block";

        // Efecto rebote
        setTimeout(() => {
          toast.classList.remove("scale-105");
        }, 300);

        // Ocultar después de 4s
        setTimeout(() => {
          toast.classList.add("translate-x-full", "opacity-0");
          setTimeout(() => {
            toast.style.display = "none";
          }, 500);
        }, 3500);
      }

      // Manejo de envío del formulario
      if (form) {
        form.addEventListener("submit", async (e: SubmitEvent) => {
          e.preventDefault();

          const formData = new FormData(form);
          const data = Object.fromEntries(formData.entries());

          try {
            const res = await fetch("/api/registrar", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            });

            const result: { ok: boolean } = await res.json();

            if (result.ok) {
              showToast("✅ Registro guardado correctamente", "success");
              form.reset();
            } else {
              showToast("❌ Error al guardar, intente de nuevo", "error");
            }
          } catch (error) {
            console.error(error);
            showToast("❌ Error de conexión con el servidor", "error");
          }
        });
      }
    });
  </script>

  <style>
    .etiqueta {
      width: 600px;
    }
    @media (max-width: 403px) {
      .content {
        margin-top: 20px;
      }
      .etiqueta {
        width: 250px;
        top: -40px;
      }
    }
  </style>
</div>
